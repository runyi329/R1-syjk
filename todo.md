# Project TODO

## 已完成功能
- [x] 后端API开发（用户管理、积分管理、商品管理、订单管理）
- [x] 用户中心页面
- [x] 兑换商城页面
- [x] 管理员后台页面
- [x] 权限控制系统

## 待修复问题
- [x] 移动端导航：登录/注册按钮在手机上不可见（hidden sm:flex导致）
- [x] OAuth登录404错误：经测试登录功能正常，之前是因为未登录状态
- [x] 移动端布局优化：所有页面已优先考虑手机版布局
- [x] 管理员后台移动端适配（用户管理已优化）
- [x] 商品管理页面移动端优化
- [x] 订单管理页面移动端优化
- [x] 用户中心页面移动端优化
- [x] 兑换商城页面移动端优化

### 新问题
- [x] 修复登录注册按钮的04错误（用户点击后显示404） - 已添加/api/oauth/login路由

## 待修复
- [x] OAuth登录返回{"message":null}错误 - 开发环境需要配置回调URL，发布后自动解决

## 新功能需求
- [x] 用户注册流程：新用户首次登录后必须设置用户名
- [x] 创建注册页面，让用户输入用户名
- [x] 后端API：添加更新用户名的接口
- [x] 首次登录检测：如果用户名为空，强制跳转到注册页面
- [x] 未注册用户无法访问其他页面

## 待解决问题
- [x] 开发环境OAuth登录404：已添加登录说明弹窗，告知用户发布后才能使用OAuth登录

## 紧急修复
- [x] 正式域名OAuth登录：移除登录说明对话框，在生产环境直接跳转OAuth登录

## 新增功能
- [x] 测试登录功能：添加测试登录按钮，无需OAuth即可快速登录
- [x] 测试登录API：创建/api/test-login端点，自动创建或登录测试账号
- [x] 首页测试登录按钮：在登录按钮旁边添加“测试登录”选项

## 紧急问题
- [x] 开发环境网站显示Not Found错误 - 已解决，开发环境正常
- [x] 正式域名(runyi.manus.space)显示Not Found - 修复测试登录session错误，使用SDK创建session token

## 待解决
- [x] 检查点卡片只显示回滚按钮 - 正在创建新检查点

## 系统状态
- 测试登录功能：正常工作
- OAuth登录：正常工作
- 用户注册流程：正常工作
- 移动端适配：已完成

## 紧急问题
- [x] runyi.manus.space网站完全无法访问 - 开发环境正常，需要发布最新版本

## 新功能需求 - 彩票分析系统
- [x] 创建彩票分析页面（/lottery）
- [x] 支持多种彩票类型：双色球、大乐透、福彩3D、排列5
- [x] 中奖概率计算器：计算各等级奖项的中奖概率
- [x] 期望收益分析：计算投注金额与期望回报
- [x] 历史数据统计：显示历史开奖号码的频率分布（模拟数据）
- [x] 号码走势分析：图表展示号码出现趋势（模拟数据）
- [x] 移动端适配：确保所有功能在手机上完美显示

## 新功能需求 - 账户余额显示优化
- [x] 修改标题：将“USDT 积分余额”和“当前可用余额”改为“总资产”
- [x] 添加隐藏功能：添加小眼睛图标，点击可隐藏/显示金额（显示为星号）
- [x] 优化布局：将USDT单位放在金额后面同一行，不另起一行

## 样式微调 - USDT单位显示
- [x] 调整USDT单位样式：改为更小的白色字体，与之前版本保持一致

## 新功能需求 - 充值提现功能
- [x] 创建充值页面（/deposit）
- [x] 显示收款地址（可复制）
- [x] 显示收款二维码
- [x] 网络选择（Aptos、Ethereum、BSC、Polygon）
- [x] 显示最小充值金额
- [x] 显示到账时间提示
- [x] 创建提现页面（/withdraw）
- [x] 输入提现地址
- [x] 输入提现金额（包含“全部”按钮）
- [x] 选择提现网络
- [x] 显示手续费和到账时间
- [x] 添加充值/提现入口到用户中心
- [x] 移动端完全适配

## 新功能需求 - 充值提现流程管理
### 数据库设计
- [x] 创建充值订单表（deposits）
- [x] 创建提现订单表（withdrawals）
- [x] 创建钱包地址表（wallet_addresses）

### 客户端功能
- [x] 充值记录查看（状态：待确认/已到账/失败）
- [x] 提现记录查看（状态：待审核/处理中/已完成/已拒绝）
- [x] 钱包地址管理页面（绑定、查看、删除）
- [x] 钱包地址绑定功能（地址、网络、二维码上传）
- [x] 提现时选择已绑定的钱包地址
- [x] 充值/提现订单详情查看

### 管理员功能
- [x] 充值订单管理页面（查看所有充值订单）
- [x] 充值订单审核（确认到账/标记失败）
- [x] 充值订单编辑（修改金额、状态、备注）
- [x] 提现订单管理页面（查看所有提现订单）
- [x] 提现订单审核（批准/拒绝）
- [x] 提现订单处理（标记已完成）
- [x] 钱包地址审核（批准/拒绝客户绑定的地址）
- [x] 订单搜索和筛选功能（基础版）

### API开发
- [x] 充值订单CRUD API
- [x] 提现订单CRUD API
- [x] 钱包地址CRUD API
- [x] 订单状态更新API
- [x] 管理员审核API

## 新功能需求 - 百家乐模拟投注
### 功能设计
- [x] 模拟局数选择：100/500/1000/5000/10000/1000000局
- [x] 带入资金输入：1000元 - 10,000,000元
- [x] 投注策略：马丁格尔倍投法（500元起注，输了翻倍，赢了重置）
- [x] 最大单注限制：2,000,000元
- [x] 随机选择下注庄或闲
- [x] 庄赢5%，闲赢不抽，和局退回
- [x] 资金不足时提前终止模拟

### 统计数据
- [x] 初始资金、限红、实际投注局数
- [x] 开庄/开闲/开和的局数和比例
- [x] 庄最长连赢/连输（和局不算断）
- [x] 闲最长连赢/连输（和局不算断）
- [x] 最终盈亏金额和盈亏率
- [x] 资金曲线图（显示资金变化趋势）
- [x] 投注历史记录（前100局详情）

### UI实现
- [x] 模拟设置面板（局数选择、资金输入）
- [x] 开始模拟按钮和进度显示
- [x] 统计结果展示卡片
- [x] 资金曲线图表（使用recharts）
- [x] 移动端完全适配

## 百家乐模拟投注优化
- [x] 添加进度条：圆形筹码图案，显示实时百分比，平均等待2-3秒
- [x] 添加快捷金额选项：10000/50000/100000/200000/500000/1000000
- [x] 颜色调整：盈利改为红色，亏损改为绿色
- [x] 优化资金曲线图颜色，避免与背景重叠
- [x] 添加“此次共投注X局”总览统计
- [x] 每个统计数据旁边显示理论期望值
- [x] 显示实际值与期望值的偏差百分比

## 百家乐模拟投注进一步优化
- [x] 优化图表坐标轴颜色：X轴和Y轴的线条和文字使用更明显的颜色（#94a3b8）
- [x] 添加最小投注金额统计
- [x] 添加最大投注金额统计
- [x] 添加平均投注金额统计
- [x] 添加平均每局盈亏统计
- [x] 添加资金最低值统计
- [x] 添加资金最高值统计
- [x] 投注历史默认显示前100局
- [x] 添加“查看全部历史”按钮（超过100局时显示）
- [x] 点击按钮展开显示所有投注记录

## 百家乐模拟投注细节优化
- [x] 资金最高值优化：显示相对本金的盈利金额和获利百分比
- [x] 平均每局盈亏优化：添加理论期望亏损值（¥-1.17）和偏差
- [x] 新增总投注金额统计：显示总投注金额和流水倍数（总投注/本金）
- [x] 颜色调整：连赢改为红色，连输改为绿色

## 百家乐模拟投注 - 继续投注功能
- [x] 添加“继续投注”按钮（仅在资金未归零时显示）
- [x] 继续投注局数与初始局数一致
- [x] 多轮投注数据合并展示（累计统计）
- [x] 资金曲线图分段显示不同颜色（第一轮橙色，第二轮蓝色，第三轮紫色等）
- [x] 资金曲线添加渐变填充效果（从曲线到X轴，透明度逐渐降低）
- [x] 不同轮次使用不同渐变颜色
- [x] 投注历史标注轮次信息（通过合并history实现）

## Bug修复 - 资金曲线图不显示
- [x] 诊断资金曲线图不显示的原因（多个Line组件使用不同data导致冲突）
- [x] 修复图表数据绑定问题（简化为单个Line组件）
- [x] 确保单轮和多轮投注的曲线都能正常显示
- [x] 测试渐变填充效果

## 投注历史显示优化
- [x] 修改投注历史默认显示为最后100局（使用slice(-100)）
- [x] 点击“查看全部”后显示所有历史记录
